<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix 矩陣</title>
    <style>
        :root {
            /* Primitive Color Tokens */
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-teal-800: rgba(41, 150, 161, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);

            /* RGB versions for opacity control */
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-red-400-rgb: 255, 84, 89;
            --color-orange-500-rgb: 168, 75, 47;
            --color-orange-400-rgb: 230, 129, 97;

            /* Background color tokens (Light Mode) */
            --color-bg-1: rgba(59, 130, 246, 0.08);
            --color-bg-2: rgba(245, 158, 11, 0.08);
            --color-bg-3: rgba(34, 197, 94, 0.08);
            --color-bg-4: rgba(239, 68, 68, 0.08);
            --color-bg-5: rgba(147, 51, 234, 0.08);
            --color-bg-6: rgba(249, 115, 22, 0.08);
            --color-bg-7: rgba(236, 72, 153, 0.08);
            --color-bg-8: rgba(6, 182, 212, 0.08);

            /* Semantic Color Tokens (Light Mode) */
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            --color-warning: var(--color-orange-500);
            --color-info: var(--color-slate-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
            --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

            /* Typography */
            --font-family-base: "Microsoft YaHei", "PingFang SC", "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            --font-size-xs: 11px;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-md: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-size-4xl: 30px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;
            --line-height-tight: 1.2;
            --line-height-normal: 1.5;
            --letter-spacing-tight: -0.01em;

            /* Spacing */
            --space-0: 0;
            --space-1: 1px;
            --space-2: 2px;
            --space-4: 4px;
            --space-6: 6px;
            --space-8: 8px;
            --space-10: 10px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;

            /* Border Radius */
            --radius-sm: 6px;
            --radius-base: 8px;
            --radius-md: 10px;
            --radius-lg: 12px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
            --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);

            /* Animation */
            --duration-fast: 150ms;
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;

                --color-bg-1: rgba(29, 78, 216, 0.15);
                --color-bg-2: rgba(180, 83, 9, 0.15);
                --color-bg-3: rgba(21, 128, 61, 0.15);
                --color-bg-4: rgba(185, 28, 28, 0.15);
                --color-bg-5: rgba(107, 33, 168, 0.15);
                --color-bg-6: rgba(194, 65, 12, 0.15);
                --color-bg-7: rgba(190, 24, 93, 0.15);
                --color-bg-8: rgba(8, 145, 178, 0.15);

                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-primary-active: var(--color-teal-800);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-warning: var(--color-orange-400);
                --color-info: var(--color-gray-300);
                --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
                --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
                --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: var(--line-height-normal);
            padding: var(--space-24);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: var(--space-32);
        }

        .header h1 {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: var(--space-16);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-32);
        }

        @media (min-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        .section {
            background-color: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-card-border);
            padding: var(--space-24);
            box-shadow: var(--shadow-sm);
        }

        .section-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-24);
            padding-bottom: var(--space-12);
            border-bottom: 2px solid var(--color-primary);
        }

        .matrix-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-16);
            margin-bottom: var(--space-24);
            flex-wrap: wrap;
        }

        .matrix-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-8);
        }

        .matrix-label {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
        }

        .matrix {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            gap: var(--space-8);
            padding: var(--space-12);
            background-color: var(--color-background);
            border-radius: var(--radius-base);
            border: 1px solid var(--color-border);
        }

        .matrix input {
            width: 60px;
            height: 60px;
            text-align: center;
            font-size: var(--font-size-base);
            font-family: var(--font-family-base);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            background-color: var(--color-surface);
            color: var(--color-text);
            transition: all var(--duration-fast) var(--ease-standard);
        }

        .matrix input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-focus-ring);
        }

        .matrix input:hover {
            border-color: var(--color-primary-hover);
        }

        .operator {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .button-group {
            display: flex;
            gap: var(--space-12);
            margin-bottom: var(--space-24);
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 140px;
            padding: var(--space-12) var(--space-20);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            font-family: var(--font-family-base);
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-standard);
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }

        .btn-primary:active {
            background-color: var(--color-primary-active);
        }

        .btn-secondary {
            background-color: var(--color-secondary);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background-color: var(--color-secondary-hover);
        }

        .btn-secondary:active {
            background-color: var(--color-secondary-active);
        }

        .result-area {
            background-color: var(--color-bg-1);
            border-radius: var(--radius-base);
            padding: var(--space-20);
            border: 1px solid var(--color-card-border);
        }

        .result-label {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-16);
            text-align: center;
        }

        .result-matrix {
            display: grid;
            grid-template-columns: repeat(3, 80px);
            gap: var(--space-8);
            padding: var(--space-16);
            background-color: var(--color-surface);
            border-radius: var(--radius-base);
            border: 1px solid var(--color-border);
            margin: 0 auto;
            width: fit-content;
        }

        .result-cell {
            width: 80px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            font-family: var(--font-family-mono);
            word-break: break-all;
            padding: var(--space-4);
        }

        .error-message {
            text-align: center;
            color: var(--color-error);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-lg);
            padding: var(--space-16);
        }

        .determinant-info {
            text-align: center;
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-12);
        }

        .clear-all-container {
            text-align: center;
            margin-top: var(--space-32);
            padding-top: var(--space-24);
            border-top: 1px solid var(--color-border);
        }

        .btn-clear {
            background-color: var(--color-secondary);
            color: var(--color-text);
            padding: var(--space-12) var(--space-32);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-standard);
        }

        .btn-clear:hover {
            background-color: var(--color-secondary-hover);
        }

        .btn-clear:active {
            background-color: var(--color-secondary-active);
        }

        @media (max-width: 768px) {
            body {
                padding: var(--space-16);
            }

            .matrix {
                grid-template-columns: repeat(3, 50px);
            }

            .matrix input {
                width: 50px;
                height: 50px;
                font-size: var(--font-size-sm);
            }

            .result-matrix {
                grid-template-columns: repeat(3, 70px);
            }

            .result-cell {
                width: 70px;
                height: 50px;
                font-size: var(--font-size-sm);
            }

            .header h1 {
                font-size: var(--font-size-3xl);
            }

            .section-title {
                font-size: var(--font-size-xl);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>矩陣 Matrix</h1>
            <p
                style="color: var(--color-text-secondary); font-size: var(--font-size-base); margin-top: var(--space-8);">
                1/(ad-bc)*[d,-b;-c,a]</p>
        </header>

        <div class="main-content">
            <!-- Matrix Multiplication Section -->
            <section class="section">
                <h2 class="section-title">乘法 Multiplication</h2>

                <div class="matrix-container">
                    <div class="matrix-wrapper">
                        <div class="matrix-label">矩陣 A Matrix A</div>
                        <div class="matrix" id="matrixA">
                            <input type="number" step="any" data-row="0" data-col="0" value="">
                            <input type="number" step="any" data-row="0" data-col="1" value="">
                            <input type="number" step="any" data-row="0" data-col="2" value="">
                            <input type="number" step="any" data-row="1" data-col="0" value="">
                            <input type="number" step="any" data-row="1" data-col="1" value="">
                            <input type="number" step="any" data-row="1" data-col="2" value="">
                            <input type="number" step="any" data-row="2" data-col="0" value="">
                            <input type="number" step="any" data-row="2" data-col="1" value="">
                            <input type="number" step="any" data-row="2" data-col="2" value="">
                        </div>
                    </div>

                    <div class="operator">×</div>

                    <div class="matrix-wrapper">
                        <div class="matrix-label">矩陣 B Matrix B</div>
                        <div class="matrix" id="matrixB">
                            <input type="number" step="any" data-row="0" data-col="0" value="">
                            <input type="number" step="any" data-row="0" data-col="1" value="">
                            <input type="number" step="any" data-row="0" data-col="2" value="">
                            <input type="number" step="any" data-row="1" data-col="0" value="">
                            <input type="number" step="any" data-row="1" data-col="1" value="">
                            <input type="number" step="any" data-row="1" data-col="2" value="">
                            <input type="number" step="any" data-row="2" data-col="0" value="">
                            <input type="number" step="any" data-row="2" data-col="1" value="">
                            <input type="number" step="any" data-row="2" data-col="2" value="">
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="calculateMultiplication()">計算 Evaluate A × B</button>
                    <button class="btn btn-secondary" onclick="loadMultiplicationExample()">載入範例 Example</button>
                </div>

                <div class="result-area" id="multiplicationResult" style="display: none;">
                    <div class="result-label">(A × B):</div>
                    <div class="result-matrix" id="resultMatrixMult"></div>
                </div>
            </section>

            <!-- Inverse Matrix Section -->
            <section class="section">
                <h2 class="section-title">反矩陣 Inverse</h2>

                <div class="matrix-container">
                    <div class="matrix-wrapper">
                        <div class="matrix-label">矩陣 M Matrix M</div>
                        <div class="matrix" id="matrixM">
                            <input type="number" step="any" data-row="0" data-col="0" value="">
                            <input type="number" step="any" data-row="0" data-col="1" value="">
                            <input type="number" step="any" data-row="0" data-col="2" value="">
                            <input type="number" step="any" data-row="1" data-col="0" value="">
                            <input type="number" step="any" data-row="1" data-col="1" value="">
                            <input type="number" step="any" data-row="1" data-col="2" value="">
                            <input type="number" step="any" data-row="2" data-col="0" value="">
                            <input type="number" step="any" data-row="2" data-col="1" value="">
                            <input type="number" step="any" data-row="2" data-col="2" value="">
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="calculateInverse()">計算 Evaluate M⁻¹</button>
                    <button class="btn btn-secondary" onclick="loadInverseExample()">載入範例 Loading Example</button>
                </div>

                <div class="result-area" id="inverseResult" style="display: none;">
                    <div class="determinant-info" id="determinantInfo"></div>
                    <div class="result-label" id="inverseLabel">(M⁻¹):</div>
                    <div class="result-matrix" id="resultMatrixInv"></div>
                    <div class="error-message" id="errorMessage" style="display: none;"></div>
                </div>
            </section>
        </div>

        <div class="clear-all-container">
            <button class="btn-clear" onclick="clearAll()">清除所有 Clear All</button>
        </div>
    </div>

    <script>
        // GCD calculation using Euclidean algorithm
        function gcd(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            while (b !== 0) {
                const temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        // Convert decimal to fraction
        function decimalToFraction(decimal) {
            // Handle integers
            if (Math.abs(decimal - Math.round(decimal)) < 0.0001) {
                return Math.round(decimal).toString();
            }

            const tolerance = 1.0e-6;
            let numerator = 1;
            let denominator = 1;

            const sign = decimal < 0 ? -1 : 1;
            decimal = Math.abs(decimal);

            // Use continued fractions algorithm
            let x = decimal;
            let a = Math.floor(x);
            let h1 = 1, h2 = 0;
            let k1 = 0, k2 = 1;
            let h = a * h1 + h2;
            let k = a * k1 + k2;

            while (Math.abs(decimal - h / k) > tolerance && k < 10000) {
                x = 1 / (x - a);
                a = Math.floor(x);
                h2 = h1;
                h1 = h;
                k2 = k1;
                k1 = k;
                h = a * h1 + h2;
                k = a * k1 + k2;
            }

            numerator = h;
            denominator = k;

            // Simplify the fraction
            const divisor = gcd(numerator, denominator);
            numerator = (sign * numerator) / divisor;
            denominator = denominator / divisor;

            // Check if it's essentially a whole number
            if (denominator === 1) {
                return numerator.toString();
            }

            return `${numerator}/${denominator}`;
        }

        // Get matrix values from input fields
        function getMatrixValues(matrixId) {
            const inputs = document.querySelectorAll(`#${matrixId} input`);
            const matrix = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];

            inputs.forEach(input => {
                const row = parseInt(input.dataset.row);
                const col = parseInt(input.dataset.col);
                const value = parseFloat(input.value) || 0;
                matrix[row][col] = value;
            });

            return matrix;
        }

        // Set matrix values to input fields
        function setMatrixValues(matrixId, matrix) {
            const inputs = document.querySelectorAll(`#${matrixId} input`);

            inputs.forEach(input => {
                const row = parseInt(input.dataset.row);
                const col = parseInt(input.dataset.col);
                input.value = matrix[row][col];
            });
        }

        // Display result matrix with fractions
        function displayResultMatrix(resultId, matrix) {
            const container = document.getElementById(resultId);
            container.innerHTML = '';

            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'result-cell';
                    // Convert to fraction
                    cell.textContent = decimalToFraction(matrix[i][j]);
                    container.appendChild(cell);
                }
            }
        }

        // Matrix multiplication: C = A × B
        function multiplyMatrices(A, B) {
            const C = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];

            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    C[i][j] = 0;
                    for (let k = 0; k < 3; k++) {
                        C[i][j] += A[i][k] * B[k][j];
                    }
                }
            }

            return C;
        }

        // Calculate determinant of 3x3 matrix
        function calculateDeterminant(M) {
            return M[0][0] * (M[1][1] * M[2][2] - M[1][2] * M[2][1]) -
                M[0][1] * (M[1][0] * M[2][2] - M[1][2] * M[2][0]) +
                M[0][2] * (M[1][0] * M[2][1] - M[1][1] * M[2][0]);
        }

        // Calculate matrix of minors
        function calculateMinors(M) {
            const minors = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];

            // For each element, calculate the determinant of the 2x2 submatrix
            minors[0][0] = M[1][1] * M[2][2] - M[1][2] * M[2][1];
            minors[0][1] = M[1][0] * M[2][2] - M[1][2] * M[2][0];
            minors[0][2] = M[1][0] * M[2][1] - M[1][1] * M[2][0];

            minors[1][0] = M[0][1] * M[2][2] - M[0][2] * M[2][1];
            minors[1][1] = M[0][0] * M[2][2] - M[0][2] * M[2][0];
            minors[1][2] = M[0][0] * M[2][1] - M[0][1] * M[2][0];

            minors[2][0] = M[0][1] * M[1][2] - M[0][2] * M[1][1];
            minors[2][1] = M[0][0] * M[1][2] - M[0][2] * M[1][0];
            minors[2][2] = M[0][0] * M[1][1] - M[0][1] * M[1][0];

            return minors;
        }

        // Apply cofactor signs (checkerboard pattern)
        function applyCofactors(minors) {
            const cofactors = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];
            const signs = [
                [1, -1, 1],
                [-1, 1, -1],
                [1, -1, 1]
            ];

            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    cofactors[i][j] = signs[i][j] * minors[i][j];
                }
            }

            return cofactors;
        }

        // Transpose matrix
        function transposeMatrix(M) {
            const T = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];

            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    T[i][j] = M[j][i];
                }
            }

            return T;
        }

        // Calculate inverse matrix
        function calculateInverseMatrix(M) {
            const det = calculateDeterminant(M);

            // Check if matrix is invertible
            if (Math.abs(det) < 0.0001) {
                return null;
            }

            // Calculate matrix of minors
            const minors = calculateMinors(M);

            // Apply cofactor signs
            const cofactors = applyCofactors(minors);

            // Transpose to get adjugate matrix
            const adjugate = transposeMatrix(cofactors);

            // Divide by determinant
            const inverse = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    inverse[i][j] = adjugate[i][j] / det;
                }
            }

            return { inverse, det };
        }

        // Calculate multiplication button handler
        function calculateMultiplication() {
            const A = getMatrixValues('matrixA');
            const B = getMatrixValues('matrixB');

            const result = multiplyMatrices(A, B);

            displayResultMatrix('resultMatrixMult', result);
            document.getElementById('multiplicationResult').style.display = 'block';
        }

        // Calculate inverse button handler
        function calculateInverse() {
            const M = getMatrixValues('matrixM');

            const result = calculateInverseMatrix(M);
            const resultArea = document.getElementById('inverseResult');
            const errorMsg = document.getElementById('errorMessage');
            const resultMatrix = document.getElementById('resultMatrixInv');
            const inverseLabel = document.getElementById('inverseLabel');
            const detInfo = document.getElementById('determinantInfo');

            resultArea.style.display = 'block';

            if (result === null) {
                // Matrix is not invertible
                errorMsg.textContent = '此矩陣不可逆 (行列式為 0)';
                errorMsg.style.display = 'block';
                resultMatrix.style.display = 'none';
                inverseLabel.style.display = 'none';
                detInfo.textContent = '行列式 = 0';
            } else {
                // Matrix is invertible
                errorMsg.style.display = 'none';
                resultMatrix.style.display = 'grid';
                inverseLabel.style.display = 'block';
                // Display determinant as both decimal and fraction if not integer
                const detFraction = decimalToFraction(result.det);
                if (detFraction.includes('/')) {
                    detInfo.textContent = `行列式 = ${result.det.toFixed(4)} = ${detFraction}`;
                } else {
                    detInfo.textContent = `行列式 = ${detFraction}`;
                }
                displayResultMatrix('resultMatrixInv', result.inverse);
            }
        }


        function randomizeMatrix(matrix, min = 1, max = 10) {
            return matrix.map(row =>
                row.map(() =>
                    Math.floor(Math.random() * (max - min + 1)) + min
                )
            );
        }

        // Load multiplication example
        function loadMultiplicationExample() {

            let exampleA = [
                [1, 2, 3],
                [4, 5, 6],
                [7, 8, 9]
            ];

            exampleA = randomizeMatrix(exampleA);

            let exampleB = [
                [9, 8, 7],
                [6, 5, 4],
                [3, 2, 1]
            ];

            exampleB = randomizeMatrix(exampleB);

            setMatrixValues('matrixA', exampleA);
            setMatrixValues('matrixB', exampleB);
        }

        // Load inverse example
        function loadInverseExample() {
            // This matrix will produce fractions in its inverse
            let exampleM = [
                [2, 0, 0],
                [0, 2, 0],
                [0, 0, 2]
            ];

            exampleM = randomizeMatrix(exampleM);

            setMatrixValues('matrixM', exampleM);
        }

        // Clear all inputs and results
        function clearAll() {
            // Clear all input fields
            const allInputs = document.querySelectorAll('input[type="number"]');
            allInputs.forEach(input => {
                input.value = '';
            });

            // Hide result areas
            document.getElementById('multiplicationResult').style.display = 'none';
            document.getElementById('inverseResult').style.display = 'none';
        }
    </script>

    <div class="page-header">
        <button class="btn btn--outline back-btn" onclick="window.location.href='index.html'">← 返回主選單 Return to
            Menu</button>
        <h2>矩陣 Matrix</h2>
    </div>


</body>

</html>